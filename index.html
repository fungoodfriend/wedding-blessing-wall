<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>婚禮祝福牆</title>
    <style>
        /* 設置基本樣式 */
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }

        h1 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        button {
            padding: 10px 20px;
            margin: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        .carousel {
            display: flex;
            overflow: hidden;
            width: 80%;
            margin: 20px auto;
            justify-content: center;
        }

        .carousel img {
            width: 100%;
            height: auto;
            transition: transform 0.5s ease-in-out;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <!-- 網頁標題 -->
    <h1>婚禮祝福牆</h1>

    <!-- 登入按鈕 -->
    <button id="authorize_button" style="display:none" onclick="handleAuthClick()">登錄</button>
    <button id="signout_button" style="display:none" onclick="handleSignoutClick()">登出</button>

    <!-- 顯示相簿照片的輪播區域 -->
    <div class="carousel" id="photoCarousel"></div>

    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://apis.google.com/js/client.js"></script>
    <script>
        // OAuth 2.0 認證
        function initClient() {
          gapi.client.init({
            apiKey: 'AIzaSyDvFD8o_OJhhmA18pK8kx1IC_GWkbXP-wE',  // 您的 API 金鑰
            clientId: '1015379017254-e0v57sbhq6dna9bhltd11egldk5c2cmj.apps.googleusercontent.com',  // OAuth 2.0 客戶端 ID
            discoveryDocs: ["https://photoslibrary.googleapis.com/$discovery/rest?version=v1"],
            scope: "https://www.googleapis.com/auth/photoslibrary.readonly"  // 訪問 Google Photos 只讀權限
          }).then(function () {
            gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
            updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
          });
        }

        // 啟動 Google API 客戶端
        gapi.load('client:auth2', initClient);

        // 處理登錄和登出
        function handleAuthClick() {
          gapi.auth2.getAuthInstance().signIn();
        }

        function handleSignoutClick() {
          gapi.auth2.getAuthInstance().signOut();
        }

        // 更新登錄狀態
        function updateSigninStatus(isSignedIn) {
          if (isSignedIn) {
            document.getElementById('authorize_button').style.display = 'none';
            document.getElementById('signout_button').style.display = 'block';
            loadPhotos();  // 登錄後載入相簿照片
          } else {
            document.getElementById('authorize_button').style.display = 'block';
            document.getElementById('signout_button').style.display = 'none';
          }
        }

        // 載入並顯示相簿中的照片
        function loadPhotos() {
          gapi.client.photoslibrary.mediaItems.list({
            pageSize: 10,  // 每次加載 10 張照片，您可以調整這個數字
            fields: "nextPageToken,mediaItems(id,baseUrl)"  // 獲取照片的 ID 和基本 URL
          }).then(function(response) {
            const photos = response.result.mediaItems;
            if (photos) {
              const carousel = document.getElementById('photoCarousel');
              carousel.innerHTML = '';  // 清空當前的照片內容
              photos.forEach(function(photo) {
                const img = document.createElement('img');
                img.src = photo.baseUrl + "=w800-h600";  // 調整圖片大小
                img.alt = "婚禮照片";
                carousel.appendChild(img);
              });
            } else {
              console.log("未找到照片。");
            }
          }).catch(function(error) {
            console.log("加載照片時發生錯誤: " + error.message);
          });
        }
    </script>
</body>
</html>
